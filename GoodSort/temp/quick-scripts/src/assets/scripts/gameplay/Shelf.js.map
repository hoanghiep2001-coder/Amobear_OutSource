{"version":3,"sources":["assets\\scripts\\gameplay\\Shelf.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Board from \"../Board\";\r\nimport { ProgressBar } from \"../Component/ProgressBar\";\r\nimport { Rocket } from \"../Component/Rocket\";\r\nimport Config from \"../config/Config\";\r\nimport { animationConfig, ConfigData, layoutConfig } from \"../config/GameConfig\";\r\nimport { PrefabSoundTrack, SoundController } from \"../Controller/SoundController\";\r\nimport Item from \"./Item\";\r\nimport Slot from \"./Slot\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Shelf extends cc.Component {\r\n  @property([cc.Prefab])\r\n  itemPrefab: cc.Prefab;\r\n\r\n  @property([cc.Prefab])\r\n  matchPrefab: cc.Prefab;\r\n\r\n  @property([cc.SpriteFrame])\r\n  shelfSprites: cc.SpriteFrame[] = [];\r\n\r\n  @property([Slot])\r\n  slots: Slot[] = [];\r\n  public sprite: cc.Sprite;\r\n  public layers: Item[][] = [];\r\n\r\n  // isActive: boolean = true;\r\n  // itemInShelfs: Item[] = [];\r\n  // @property(cc.Prefab)\r\n  // rocketHelper: cc.Prefab = null;\r\n\r\n  _Board: Board = null;\r\n\r\n  onLoad() {\r\n    this.sprite = this.getComponent(cc.Sprite);\r\n  }\r\n\r\n\r\n  // _isHasRocket: boolean = false;\r\n  // _isSpawnRocket: boolean = false;\r\n  protected start(): void {\r\n    // const num: number = cc.math.randomRangeInt(0, 2);\r\n    // const random: boolean = num === 1 ? true : false;\r\n    // if(random) this._isHasRocket = true;\r\n  }\r\n\r\n\r\n  // public _canSpawnRocket: boolean = false;\r\n  // _rocket: Rocket = null;\r\n  // private spawnRocket(pos: cc.Vec2, parent: cc.Node): void {\r\n  //   if (!this._canSpawnRocket || ConfigData.Helper.maxRocketCanSpawn <= 0) return;\r\n  //   // this._isSpawnRocket = true;\r\n  //   ConfigData.Helper.maxRocketCanSpawn -= 1;\r\n  //   const _r = cc.instantiate(this.rocketHelper);\r\n  //   _r.parent = parent;\r\n  //   _r.setPosition(0, 130);\r\n  //   _r.setScale(0.23);\r\n  //   this._rocket = _r.getComponent(Rocket);\r\n  //   parent.getComponent(Item)._isHasRocket = true;\r\n  //   // const _rWPos = parent.convertToWorldSpaceAR(_r.getPosition());\r\n  //   // ConfigData.Idea.fakeRocketPoses.push(parent.getPosition());\r\n  //   // ConfigData.Idea.fakeRocketPoses.push(this.node.getPosition());\r\n  //   ConfigData.Idea.shelf.push(this);\r\n  // }\r\n\r\n\r\n\r\n  initialize() { }\r\n\r\n\r\n  _itemContainer: cc.Node = null;\r\n  addItem(\r\n    itemId: number,\r\n    positionIndex: number,\r\n    layer: number,\r\n    parent: cc.Node,\r\n    board: Board,\r\n    config: Config\r\n  ): Item {\r\n    const item = cc.instantiate(this.itemPrefab).getComponent(Item);\r\n    item._Board = board;\r\n    item._Config = config;\r\n    item.setId(itemId);\r\n    if (this.layers[layer] == null) {\r\n      this.layers[layer] = [];\r\n    }\r\n    this.layers[layer].push(item);\r\n\r\n    this.node.addChild(item.node, -1 * layer);\r\n\r\n    const tempPos = item.node.parent.convertToWorldSpaceAR(\r\n      this.slots[positionIndex].node\r\n        .getPosition()\r\n        .add(new cc.Vec2(0, 0))\r\n    );\r\n    const tempBehindPos = item.node.parent.convertToWorldSpaceAR(\r\n      this.slots[positionIndex].node\r\n        .getPosition()\r\n        .add(new cc.Vec2(0, layer * layoutConfig.backItemOffsetY))\r\n    );\r\n    const itemPos = parent.convertToNodeSpaceAR(tempPos);\r\n    item.node.setParent(parent);\r\n    item.node.setPosition(itemPos);\r\n\r\n    const behindPos = parent.convertToNodeSpaceAR(tempBehindPos);\r\n\r\n    this._itemContainer = parent;\r\n\r\n    if (layer == 0) {\r\n      this.slots[positionIndex].setItem(item);\r\n      item.setSlot(this.slots[positionIndex]);\r\n    }\r\n\r\n    item.handleMoveToBehind(behindPos, layer);\r\n    item.setIndex(positionIndex);\r\n    // item.node.setScale(0.1, 0.1);\r\n    return item;\r\n  }\r\n  setShelfType(shelfType: ShelfType) {\r\n    switch (shelfType) {\r\n      case ShelfType.Middle:\r\n        this.sprite.spriteFrame = this.shelfSprites[0];\r\n        break;\r\n      case ShelfType.Left:\r\n        this.sprite.spriteFrame = this.shelfSprites[1];\r\n        break;\r\n      case ShelfType.Right:\r\n        this.sprite.spriteFrame = this.shelfSprites[2];\r\n        this.node.scaleX = -1;\r\n        break;\r\n\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n  testMatch(lastItemId: number, layer: number): boolean {\r\n    if (this.layers[layer] == null) {\r\n      return false;\r\n    }\r\n    if (this.layers[layer].length < 2) return false;\r\n    if (\r\n      this.layers[layer][0].id == this.layers[layer][1].id &&\r\n      this.layers[layer][0].id == lastItemId\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  checkMatch() {\r\n    for (let i = 0; i < this.slots.length; i++) {\r\n      if (this.slots[i].isEmpty()) return false;\r\n    }\r\n    if (\r\n      this.slots[0].item.id === this.slots[1].item.id &&\r\n      this.slots[0].item.id === this.slots[2].item.id\r\n    ) {\r\n\r\n      const effectPos = this._Board.node.convertToNodeSpaceAR(\r\n        this.node.parent.convertToWorldSpaceAR(this.node.position)\r\n      );\r\n\r\n      for (let i = 0; i < this.slots.length; i++) {\r\n\r\n        // this.slots[i].item._isHasRocket && ConfigData.Idea.isShelfExplosionWhenHitRocket && this.changeParentRocket()\r\n        // this.slots[i].item._isHasRocket\r\n        //   && ConfigData.Idea.isShelfExplosionWhenHitRocket\r\n        //   && this._Board.createRockets(effectPos);\r\n\r\n        this.removeItem(this.slots[i].item);\r\n        this.slots[i].item.match();\r\n        this.slots[i].setEmpty();\r\n      }\r\n\r\n\r\n      // console.log(this.slots[0].item);\r\n      // console.log(this.slots[1].item);\r\n      // console.log(this.slots[2].item);\r\n\r\n      // this.IsMatchWithRocket() && ConfigData.Idea.isShelfExplosionWhenHitRocket && this._rocket.activeRocket();\r\n\r\n\r\n      this.createMatchFx(effectPos);\r\n      this.checkBackLayer();\r\n      ProgressBar.Instance.fillRangeProgress();\r\n      SoundController.Instance(SoundController).playPrefabSound(PrefabSoundTrack.tripleMatchSortSound);\r\n      // this._Board.updateCombo();\r\n      this._Board.updateMatchCount();\r\n\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  private changeParentRocket(): void {\r\n    // const _wp = this._rocket.node.convertToWorldSpaceAR(this._rocket.node.getPosition())\r\n    // this._rocket.node.parent = this._itemContainer;\r\n    // this._rocket.node.setPosition(this._itemContainer.convertToNodeSpaceAR(_wp))\r\n    // this._rocket.activeRocket();\r\n    // Board.Instance.setRocketHighestZindex();\r\n  }\r\n\r\n\r\n  private createMatchFx(effectPos): void {\r\n    const effect = cc.instantiate(this.matchPrefab);\r\n    effect.setParent(this._Board.node);\r\n    effect.setPosition(effectPos);\r\n  }\r\n\r\n\r\n  checkBackLayer() {\r\n    let allEmpty = true;\r\n    for (let i = 0; i < this.slots.length; i++) {\r\n      if (!this.slots[i].isEmpty()) {\r\n        allEmpty = false;\r\n      }\r\n    }\r\n    if (allEmpty) {\r\n      let lay = 0;\r\n      for (let i = 0; i < this.layers.length; i++) {\r\n        if (this.layers[i].length > 0) {\r\n          if (lay == 0) {\r\n            for (let j = 0; j < this.layers[i].length; j++) {\r\n              const item = this.layers[i][j];\r\n              if (item === null || item === undefined) continue;\r\n              item.setActive(true);\r\n              item.setSlot(this.slots[item.index]);\r\n              this.slots[item.index].setItem(this.layers[i][j]);\r\n            }\r\n          }\r\n          for (let j = 0; j < this.layers[i].length; j++) {\r\n            let index = j;\r\n            const item = this.layers[i][index];\r\n            if (item === null || item === undefined) continue;\r\n            item.node.active = lay < 2;\r\n            const tempPos = this.node.convertToWorldSpaceAR(\r\n              this.slots[item.index].node\r\n                .getPosition()\r\n                .add(new cc.Vec2(0, lay * layoutConfig.backItemOffsetY))\r\n            );\r\n            let target = item.node.parent.convertToNodeSpaceAR(tempPos);\r\n            item.moveTo(target);\r\n          }\r\n          lay++;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  replaceItem(oldItem: Item, newItem) {\r\n    for (let i = 0; i < this.layers.length; i++) {\r\n      if (this.layers[i] === null || this.layers[i] === undefined) continue;\r\n      for (let j = 0; j < this.layers[i].length; j++) {\r\n        if (this.layers[i][j] === oldItem) {\r\n          this.layers[i][j] = newItem;\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  removeItem(item: Item) {\r\n    for (let i = 0; i < this.layers.length; i++) {\r\n      if (this.layers[i] === null || this.layers[i] === undefined) continue;\r\n      for (let j = 0; j < this.layers[i].length; j++) {\r\n        if (this.layers[i][j] === item) {\r\n          this.layers[i].splice(j, 1);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\nexport enum ShelfType {\r\n  Middle,\r\n  Left,\r\n  Right,\r\n}\r\n"]}