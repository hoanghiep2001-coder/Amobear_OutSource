{"version":3,"sources":["assets\\scripts\\gameplay\\Item.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Board, { BoardState } from \"../Board\";\r\nimport Config from \"../config/Config\";\r\nimport { animationConfig, ConfigData } from \"../config/GameConfig\";\r\nimport { LoopedSoundTrack, PrefabSoundTrack, SoundController } from \"../Controller/SoundController\";\r\n// import { LoopedSoundTrack, PrefabSoundTrack, SoundController } from \"../Controller/SoundController\";\r\nimport Shelf from \"./Shelf\";\r\nimport Slot from \"./Slot\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Item extends cc.Component {\r\n  @property([cc.Sprite])\r\n  sprite: cc.Sprite;\r\n\r\n  @property([cc.Color])\r\n  lockColor: cc.Color = new cc.Color(87, 87, 87, 255);\r\n\r\n  public id: number;\r\n  public index: number;\r\n  private initialTouchPos: cc.Vec2 = null;\r\n  private deltaPos: cc.Vec2;\r\n  private isLock = false;\r\n  // public shelf: Shelf;\r\n  public currentSlot: Slot;\r\n\r\n  private nearestSlot: Slot = null;\r\n  private touching = false;\r\n\r\n\r\n  // PA_02\r\n  itemPos: cc.Vec2 = null;\r\n  itemRotate: number = null;\r\n\r\n\r\n  start() {\r\n    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n    this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n  }\r\n  setLock(isLock: boolean) {\r\n    this.isLock = isLock;\r\n  }\r\n  setActive(isActive: boolean) {\r\n    this.isLock = !isActive;\r\n    if (!isActive) {\r\n      this.node.color = this.lockColor;\r\n    } else {\r\n      this.node.color = cc.Color.WHITE;\r\n    }\r\n  }\r\n  setActiveAnimation(isActive: boolean) {\r\n    this.isLock = !isActive;\r\n    let fadeDuration = 0.2;\r\n    if (!isActive) {\r\n      // this.node.color = this.lockColor;\r\n      cc.tween(this.node).to(fadeDuration, {\r\n        color: this.lockColor,\r\n      }).start();\r\n    } else {\r\n      // this.node.color = this.lockColor;\r\n      cc.tween(this.node).to(fadeDuration, {\r\n        color: cc.Color.WHITE,\r\n      }).start();\r\n    }\r\n  }\r\n\r\n\r\n  setSlot(slot: Slot) {\r\n    this.currentSlot = slot;\r\n    this.setIndex(slot.index);\r\n  }\r\n\r\n\r\n  _Config: Config = null;\r\n  setId(id: number) {\r\n    this.id = id;\r\n    this.sprite.spriteFrame = this._Config.itemConfig.getSprite(id);\r\n  }\r\n  setIndex(index: number) {\r\n    this.index = index;\r\n  }\r\n\r\n\r\n  _Board: Board = null;\r\n  match() {\r\n    this._Board.setBoardState(BoardState.Lock);\r\n    cc.tween(this.node)\r\n      .delay(0.2)\r\n      .to(\r\n        animationConfig.matchDuration,\r\n        {\r\n          scale: 0,\r\n        },\r\n        {\r\n          easing: \"backIn\",\r\n        }\r\n      )\r\n      .call(() => {\r\n        this.node.destroy();\r\n      })\r\n      .start();\r\n  }\r\n  moveTo(target: cc.Vec2) {\r\n    // this.setLock(true);\r\n    this._Board.setBoardState(BoardState.Lock);\r\n    cc.tween(this.node)\r\n      .to(animationConfig.toSlotDuration, {\r\n        position: new cc.Vec3(target.x, target.y, 0),\r\n      })\r\n      .call(() => {\r\n        this._Board.setBoardState(BoardState.Playing);\r\n        // this.setLock(false);\r\n      })\r\n      .start();\r\n  }\r\n  handleMoveToBehind(target: cc.Vec2, layer: number) {\r\n    this.node.scale = 0;\r\n    cc.tween(this.node)\r\n      .to(animationConfig.spawnDuration, {\r\n        scale: 0.86,\r\n      }, { easing: \"backOut\" })\r\n      .to(animationConfig.spawnDuration, {\r\n        position: new cc.Vec3(target.x, target.y, 0),\r\n      }, { easing: \"backIn\" })\r\n      .call(() => {\r\n        if (layer > 0) {\r\n          this.setActiveAnimation(false);\r\n        }\r\n        else {\r\n          this._Board.handleCompleteGenerate();\r\n        }\r\n        this._Board.hideItemsLayer(layer + 2);\r\n      })\r\n      .start();\r\n  }\r\n\r\n  onTouchStart(event: cc.Event.EventTouch) {\r\n\r\n    if (!ConfigData.Game.isCanClick) return;\r\n\r\n    if (this.isLock || this._Board.isLock() || this._Board.isGenerating()) return;\r\n\r\n    SoundController.Instance(SoundController).playPrefabSound(PrefabSoundTrack.tilePickedSound);\r\n\r\n    this._Board.hideHand();\r\n    this.initialTouchPos = event.getLocation();\r\n    this.node.setSiblingIndex(this.node.parent.childrenCount);\r\n    this.node.zIndex = 0;\r\n    this.touching = true;\r\n  }\r\n\r\n  // this.initialTouchPos = new cc.Vec2(localTouchPos.x, localTouchPos.y);\r\n\r\n  touchOffset: cc.Vec3 = new cc.Vec3(0, -50);\r\n  onTouchMove(event: cc.Event.EventTouch) {\r\n    if (!ConfigData.Game.isCanClick) return;\r\n    if (this.isLock || this._Board.isLock() || !this.touching) return;\r\n\r\n    let currentTouchPos = event.getLocation();\r\n\r\n    // Chuyển vị trí chạm sang tọa độ local của node cha (dưới dạng Vec2)\r\n    let localTouchPos2D = this.node.parent.convertToNodeSpaceAR(currentTouchPos);\r\n    let localTouchPos = new cc.Vec3(localTouchPos2D.x, localTouchPos2D.y, 0); // Chuyển thành Vec3\r\n\r\n    if (!this.initialTouchPos) {\r\n      // Lưu vị trí chạm đầu tiên & tính offset\r\n      this.initialTouchPos = new cc.Vec2(localTouchPos.x, localTouchPos.y);\r\n      this.touchOffset = this.node.position.sub(localTouchPos);\r\n    }\r\n\r\n    // Đảm bảo touchOffset không null trước khi sử dụng\r\n    if (!this.touchOffset) {\r\n      this.touchOffset = cc.Vec3.ZERO;\r\n    }\r\n\r\n    // Cập nhật vị trí của node theo vị trí chạm mới + offset ban đầu\r\n    this.node.setPosition(localTouchPos.add(this.touchOffset));\r\n  }\r\n\r\n  // onTouchMove(event: cc.Event.EventTouch) {\r\n  //   if(!ConfigData.Game.isCanClick) return;\r\n  //   if (this.isLock || this._Board.isLock() || !this.touching) return;\r\n  //   let currentTouchPos = event.getLocation();\r\n  //   if (this.initialTouchPos === null) {\r\n  //     this.initialTouchPos = event.getLocation();\r\n  //   }\r\n  //   this.deltaPos = currentTouchPos.sub(this.initialTouchPos);\r\n  //   this.node.setPosition(this.node.position.add(new cc.Vec3(this.deltaPos.x, this.deltaPos.y, 0)));\r\n  //   this.initialTouchPos = currentTouchPos;\r\n  // }\r\n\r\n  onTouchEnd(event: cc.Event.EventTouch) {\r\n    if (!ConfigData.Game.isCanClick) return;\r\n\r\n    if (this.isLock || this._Board.isLock() || !this.touching) return;\r\n    this.touching = false;\r\n    if (this.nearestSlot === null) {\r\n      this.nearestSlot = this.currentSlot;\r\n    }\r\n    let tempPos = this.nearestSlot.node.parent.convertToWorldSpaceAR(\r\n      this.nearestSlot.node.position\r\n    );\r\n    let targetPos = this.node.parent.convertToNodeSpaceAR(tempPos);\r\n\r\n    // SoundController.Instance(SoundController).playPrefabSound(PrefabSoundTrack.onShelfSound);\r\n\r\n    // this.setLock(true);\r\n    this._Board.setBoardState(BoardState.Lock);\r\n    cc.tween(this.node)\r\n      .to(animationConfig.toSlotDuration, {\r\n        position: targetPos,\r\n      })\r\n      .call(() => {\r\n\r\n        // this.setLock(false);\r\n        this.nearestSlot.setItem(this);\r\n        console.log(\"check\");\r\n        console.log(this.nearestSlot, this.currentSlot);\r\n        \r\n        if (this.currentSlot !== this.nearestSlot) {\r\n\r\n          console.log(\"check\");\r\n          this.currentSlot.setEmpty();\r\n          this.currentSlot.checkShelf();\r\n          this.setSlot(this.nearestSlot);\r\n          this.currentSlot.checkMatch();\r\n        }\r\n        this.scheduleOnce(() => {\r\n          this._Board.setBoardState(BoardState.Playing);\r\n        }, 0.1);\r\n      })\r\n      .start();\r\n  }\r\n\r\n\r\n  onCollisionEnter(other: cc.Collider, self: cc.Collider) {\r\n    if (this.touching == false) return;\r\n    if (other.node.group == \"slot\") {\r\n      console.log(\"check\");\r\n      \r\n      if (other.node.getComponent(Slot).isEmpty()) {\r\n        this.nearestSlot = other.node.getComponent(Slot);\r\n        // return;\r\n      }\r\n      // this.nearestSlot = other.node.getComponent(Slot);\r\n    }\r\n  }\r\n\r\n\r\n  onCollisionExit(other: cc.Collider, self: cc.Collider) {\r\n    if (this.touching == false) return;\r\n    if (other.node.group == \"slot\") {\r\n      \r\n      if (\r\n        other.node.getComponent(Slot) === this.nearestSlot ||\r\n        this.nearestSlot === null\r\n      ) {\r\n        console.log(\"check\");\r\n        this.nearestSlot = this.currentSlot;\r\n      }\r\n    }\r\n  }\r\n  protected onDestroy(): void {\r\n    if (this._Board.isLock) {\r\n      this._Board.setBoardState(BoardState.Playing);\r\n    }\r\n  }\r\n}\r\n"]}